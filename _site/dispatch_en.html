<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Server Dispatch | Jekyll theme for documentation</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> CoolKit Cloud Platform</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
		<li style="line-height: 50px;">
		    <label><a href="index.html">中文</a></label>
		    <label><a href="platformOverview_en.html">English</a></label>
		</li>
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Server Dispatch">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">CoolKit Cloud Platform 2.0</li>
  
  
  
  <li>
      
      <a href="platformOverview_en.html">Platform Overview</a>
      
      <ul>
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="apiFee_en.html">API Fee</a>
      
      <ul>
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#">Getting Started</a>
      
      <ul>
          
          
          
          <li><a href="developerGuide_en.html">Developer Guide</a></li>
          
          
          
          
          
          
          <li><a href="develop_en.html">Prepare Your Development Environment</a></li>
          
          
          
          
          
          
          <li><a href="developer_en.html">Become A Developer</a></li>
          
          
          
          
          
          
          <li><a href="application_en.html">Create Your First Application</a></li>
          
          
          
          
          
          
          <li><a href="instruction_en.html">General Developer Instruction</a></li>
          
          
          
          
          
          
          <li><a href="pair_en.html">Pairing Process</a></li>
          
          
          
          
          
          
          <li><a href="sdk_en.html">SDK</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#">API Center</a>
      
      <ul>
          
          
          
          <li><a href="apiOverview_en.html">API Overview</a></li>
          
          
          
          <li class="subfolders">
              <a href="#">Region</a>
              <ul>
                  
                  
                  
                  <li><a href="region_en.html">Check current region</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          <li class="subfolders">
              <a href="#">Account Management</a>
              <ul>
                  
                  
                  
                  <li><a href="code_en.html">Verification code</a></li>
                  
                  
                  
                  
                  
                  <li><a href="register_en.html">Register</a></li>
                  
                  
                  
                  
                  
                  <li><a href="findpassword_en.html">Reset password</a></li>
                  
                  
                  
                  
                  
                  <li><a href="updatePassword_en.html">Change Password</a></li>
                  
                  
                  
                  
                  
                  <li><a href="login_en.html">Login</a></li>
                  
                  
                  
                  
                  
                  <li><a href="token_en.html">Token Refresh</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          <li class="subfolders">
              <a href="#">Device Management</a>
              <ul>
                  
                  
                  
                  <li><a href="devices_en.html">Device List</a></li>
                  
                  
                  
                  
                  
                  <li><a href="device_en.html">Check Device</a></li>
                  
                  
                  
                  
                  
                  <li><a href="addDevice_en.html">Add Device</a></li>
                  
                  
                  
                  
                  
                  <li><a href="deleteDevice_en.html">Delete Device</a></li>
                  
                  
                  
                  
                  
                  <li><a href="updateDevice_en.html">Change Device Name</a></li>
                  
                  
                  
                  
                  
                  <li><a href="addGsm_en.html">Add GSM Device</a></li>
                  
                  
                  
                  
                  
                  <li><a href="addDeviceGroup_en.html">Add Group</a></li>
                  
                  
                  
                  
                  
                  <li><a href="updateGroup_en.html">Change Group</a></li>
                  
                  
                  
                  
                  
                  <li><a href="deleteGroup_en.html">Delete Group</a></li>
                  
                  
                  
                  
                  
                  <li><a href="addToGroup_en.html">Add device to Group</a></li>
                  
                  
                  
                  
                  
                  <li><a href="findGroup_en.html">Check Group</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          <li class="subfolders">
              <a href="#">Device Control</a>
              <ul>
                  
                  
                  
                  <li class="active"><a href="dispatch_en.html">Server Dispatch</a></li>
                  
                  
                  
                  
                  
                  <li><a href="handshake_en.html">Handshake</a></li>
                  
                  
                  
                  
                  
                  <li><a href="online_en.html">Device Online/Offline</a></li>
                  
                  
                  
                  
                  
                  <li><a href="deviceStatus_en.html">Update/Report Status</a></li>
                  
                  
                  
                  
                  
                  <li><a href="findStatus_en.html">Check Device Status</a></li>
                  
                  
                  
                  
                  
                  <li><a href="share_en.html">Share Device</a></li>
                  
                  
                  
                  
                  
                  <li><a href="shareUpdate_en.html">Update Share</a></li>
                  
                  
                  
                  
                  
                  <li><a href="shareCancel_en.html">Cancel Share</a></li>
                  
                  
                  
                  
                  
                  <li><a href="deviceStatusHttp_en.html">Check Device Status</a></li>
                  
                  
                  
                  
                  
                  <li><a href="updateStatusHttp_en.html">Update Device Status</a></li>
                  
                  
                  
              </ul>
          </li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="#">FAQ</a>
      
      <ul>
          
          
          
          <li><a href="faqOauth_en.html">Authentication</a></li>
          
          
          
          
          
          
          <li><a href="faqCode_en.html">Verification code</a></li>
          
          
          
          
          
          
          <li><a href="faqAccount_en.html">Account</a></li>
          
          
          
          
          
          
          <li><a href="faqDevice_en.html">Device</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      
      <a href="contactUs_en.html">Contact Us</a>
      
      <ul>
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Server Dispatch</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

   <p>All APIs are based on websocket protocol except for server dispatch.</p>

<p>Client accesses Server Dispatch API to get the ip,domain and port of persistent connection,creates persistent connection,and send handsake command to register.Then it is ready to send other commands to control devices.</p>

<p>After connecting to websocket, the client needs to send a websocket ping every n second to keep connection alive. n is determined by the return value of handshake.In case no pong from server is received in 3 seconds, connection will be closed and rebuilding connection is needed.</p>

<p><strong>Comman Note(Important)：</strong></p>

<p>Format of websocket address: <code class="highlighter-rouge">wss://ip_address:port/api/ws</code></p>

<p>ip_address: returned by Server Dispatch API.(use ip first,only use domain name when impossible to skip certificate check)</p>

<p>port: returned by Server Dispatch</p>

<p>/api/ws:fixed suffix，to build complete url with previous dynamic paramters.</p>

<p>Note：When wss connection is created, client will verify whether visiting domain name matches certificate domain.Therefore,error will be returned when connection is built by ip.If possible, client must skip certificate domain check(android and java can do this).In case that certificate check can’t be skipped, then wss connection has to be built with domain name.</p>

<p>App accesses this API to check the info(ip,port) of persistent connection for websocket, and then build persistent connection.</p>
<ul>
  <li>Note：Authorization header should contain access token.</li>
  <li>Production environment URL: <code class="highlighter-rouge">https://cn(区域)-disp.coolkit.cn:8080/dispatch/app</code></li>
  <li>Test environment URL: <code class="highlighter-rouge">https://testapi.coolkit.cn:8080/dispatch/app</code></li>
  <li>
    <p>Request method： POST</p>
  </li>
  <li>Request parameters：</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parameter</th>
      <th style="text-align: left">Required</th>
      <th style="text-align: left">Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">accept</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>only ws now</td>
    </tr>
    <tr>
      <td style="text-align: left">version</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">Int</td>
      <td>version:8</td>
    </tr>
    <tr>
      <td style="text-align: left">appid</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>app id provided by Coolkit</td>
    </tr>
    <tr>
      <td style="text-align: left">ts</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">Int</td>
      <td>timestamp to second(from 1970)</td>
    </tr>
    <tr>
      <td style="text-align: left">nonce</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>32-digit random integer in hexadecimal，say 8-digit random value of letters and numbers</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Response parameters：</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parameter</th>
      <th style="text-align: left">Required</th>
      <th style="text-align: left">Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">error</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">Int</td>
      <td>error code</td>
    </tr>
    <tr>
      <td style="text-align: left">reason</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>error description</td>
    </tr>
    <tr>
      <td style="text-align: left">requestid</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>ts+”-“+nonce</td>
    </tr>
    <tr>
      <td style="text-align: left">IP</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>persistent connection to server IP</td>
    </tr>
    <tr>
      <td style="text-align: left">port</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">Int</td>
      <td>persistent connection to server port</td>
    </tr>
    <tr>
      <td style="text-align: left">domain</td>
      <td style="text-align: left">Yes</td>
      <td style="text-align: left">String</td>
      <td>persistent connection to server domain.Currently, only app client returns domain.IP should be the first selection of android client to reduce issues caused by dns resolution.As js client could not skip certificate check,only domain can be used.</td>
    </tr>
  </tbody>
</table>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error code
0:success
400:wrong parameter
401:authorization failed(remind to login)
402:expired(app auto refreshes access token)
403:no permission(app prompts no permission,e.g.app no access to OTA)(401-403 are authorization errors sent by internal authorization system)
500:server error
</code></pre></div></div>




</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2019 Coolkit Technology Co.,Ltd. All rights reserved. <br />
<span>Page last updated:</span> 2019-03-20<br/>
<p><img src="images/coolkit.png" alt="CoolKit"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>
</html>
